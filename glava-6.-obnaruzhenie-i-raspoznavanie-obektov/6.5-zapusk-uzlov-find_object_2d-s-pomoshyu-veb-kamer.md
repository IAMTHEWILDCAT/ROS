# 6.5 Запуск узлов find\_object\_2d с помощью веб-камер

Вот процедура для запуска узлов детектора для веб-камеры. Если мы хотим обнаружить объект используя веб-камеру, нам сначала нужно установить пакет usb\_cam, который обсуждался в Главе 2, Обнаружение и отслеживание лиц с использованием сервоприводов ROS, OpenCV и Dynamixel. 

1. Старт roscore:

```text
$ roscore
```

2.Подключите USB-камеру к компьютеру и запустите драйвер ROS usb\_cam:

```text
$ roslaunch usb_cam usb_cam-test.launch
```

Это запустит драйвер ROS для веб-камер USB, и вы сможете перечислить темы в этом драйвере с помощью команды rostopic list. Список тем в драйвере показаны здесь:

![&#x420;&#x438;&#x441;&#x443;&#x43D;&#x43E;&#x43A; 3: &#x422;&#x435;&#x43C;&#x44B;, &#x43F;&#x443;&#x431;&#x43B;&#x438;&#x43A;&#x443;&#x435;&#x43C;&#x44B;&#x435; &#x438;&#x437; &#x434;&#x440;&#x430;&#x439;&#x432;&#x435;&#x440;&#x430; &#x43A;&#x430;&#x43C;&#x435;&#x440;&#x44B;](../.gitbook/assets/zjupuyuo%20%283%29.jpg)



3.Из списка тем мы собираемся использовать тему сырого изображения с камеры, которая публикуется в теме / usb\_cam / image\_raw. Если вы получаете эту тему, то следующим шагом будет запуск узла детектора объектов. Последующая команда запустит узел детектора объектов:

```text
$ rosrun find_object_2d find_object_2d image:=/usb_cam/image_raw
```

Эта команда откроет окно детектора объектов, показанное на предыдущем снимке экрана, на котором мы видим изображение с камеры и характерные точки на объектах.



4.Итак, как мы можем использовать его для обнаружения объекта? Вот процедуры для выполнения базовое обнаружение с помощью этого инструмента:

![&#x420;&#x438;&#x441;&#x443;&#x43D;&#x43E;&#x43A; 4: &#x41E;&#x43A;&#x43D;&#x43E; &#x434;&#x435;&#x442;&#x435;&#x43A;&#x442;&#x43E;&#x440;&#x430; Find-Object](../.gitbook/assets/zjupuyuo%20%282%29.jpg)



5.Вы можете щелкнуть правой кнопкой мыши на левой боковой панели \(Объекты\) этого окна, и вы получите возможность добавлять объекты со сцены. Если вы выберете этот вариант, вы будете направленны на отметку объекта из текущей сцены, а после завершения маркировки, отмеченный объект начнет отслеживание со сцены. На предыдущем скриншоте показан первый шаг, на котором делается снимок сцены с объектом.

6.Выровняв объект по направлению к камере, нажмите кнопку «Сделать снимок», чтобы сделать снимок объекта:

![&#x420;&#x438;&#x441;&#x443;&#x43D;&#x43E;&#x43A; 5: &#x41C;&#x430;&#x441;&#x442;&#x435;&#x440; &#x434;&#x43E;&#x431;&#x430;&#x432;&#x43B;&#x435;&#x43D;&#x438;&#x44F; &#x43E;&#x431;&#x44A;&#x435;&#x43A;&#x442;&#x430; &#x434;&#x43B;&#x44F; &#x441;&#x43E;&#x437;&#x434;&#x430;&#x43D;&#x438;&#x44F; &#x441;&#x43D;&#x438;&#x43C;&#x43A;&#x430; &#x43E;&#x431;&#x44A;&#x435;&#x43A;&#x442;&#x430;](../.gitbook/assets/46zufad5%20%286%29.jpg)



6.Следующее окно предназначено для выделения объекта из текущей привязки. Последующий рисунок показывает это. Мы можем использовать указатель мыши, чтобы отметить объект. Нажмите на кнопку Далее, чтобы обрезать объект, и вы можете перейти к следующему шагу:

![&#x420;&#x438;&#x441;&#x443;&#x43D;&#x43E;&#x43A; 6: &#x41C;&#x430;&#x441;&#x442;&#x435;&#x440; &#x434;&#x43E;&#x431;&#x430;&#x432;&#x43B;&#x435;&#x43D;&#x438;&#x44F; &#x43E;&#x431;&#x44A;&#x435;&#x43A;&#x442;&#x430; &#x434;&#x43B;&#x44F; &#x43F;&#x43E;&#x43C;&#x435;&#x442;&#x43A;&#x438; &#x43E;&#x431;&#x44A;&#x435;&#x43A;&#x442;&#x430;](../.gitbook/assets/46zufad5%20%284%29.jpg)

8.После кадрирования объекта он покажет вам общее количество дескрипторов функций на объекте, и вы сможете нажать кнопку Конец, чтобы добавить шаблон объекта для обнаружения. На следующем рисунке показан последний этап добавления шаблона объекта к этому приложению детектора:

![&#x420;&#x438;&#x441;&#x443;&#x43D;&#x43E;&#x43A; 7: &#x41F;&#x43E;&#x441;&#x43B;&#x435;&#x434;&#x43D;&#x438;&#x439; &#x448;&#x430;&#x433; &#x43C;&#x430;&#x441;&#x442;&#x435;&#x440;&#x430; &#x434;&#x43E;&#x431;&#x430;&#x432;&#x43B;&#x435;&#x43D;&#x438;&#x44F; &#x43E;&#x431;&#x44A;&#x435;&#x43A;&#x442;&#x430;](../.gitbook/assets/46zufad5%20%281%29.jpg)

9.Поздравляю! Вы добавили объект для обнаружения. Незамедлительно после добавления объекта, вы сможете увидеть обнаружение, показанное ниже на рисунке. Вы можете увидеть ограничительную рамку вокруг обнаруженного объекта:

![&#x420;&#x438;&#x441;&#x443;&#x43D;&#x43E;&#x43A; 8: &#x41C;&#x430;&#x441;&#x442;&#x435;&#x440; &#x43F;&#x43E;&#x438;&#x441;&#x43A;&#x430; &#x43E;&#x431;&#x44A;&#x435;&#x43A;&#x442;&#x430; &#x437;&#x430;&#x43F;&#x443;&#x441;&#x43A;&#x430;&#x435;&#x442; &#x43E;&#x431;&#x43D;&#x430;&#x440;&#x443;&#x436;&#x435;&#x43D;&#x438;&#x435;](../.gitbook/assets/46zufad5%20%282%29.jpg)

10.Этого достаточно? А как насчет положения объекта? Мы можем получить положение объекта с помощью следующей команды:

```text
$ rosrun find_object_2d print_objects_detected
```

![&#x420;&#x438;&#x441;&#x443;&#x43D;&#x43E;&#x43A; 9: &#x414;&#x435;&#x442;&#x430;&#x43B;&#x438; &#x43E;&#x431;&#x44A;&#x435;&#x43A;&#x442;&#x430;](../.gitbook/assets/46zufad5%20%283%29.jpg)

11.Вы также можете получить полную информацию об обнаруженном объекте из / object topic. В теме публикуется мульти-массив, состоящий из ширины и высоты объекта и матрица гомографии для вычисления положения и ориентации объекта , его масштаба и значения сдвига. Вы можете повторить / objects, чтобы получить такой вывод:

![&#x420;&#x438;&#x441;&#x443;&#x43D;&#x43E;&#x43A; 10: &#x417;&#x43D;&#x430;&#x447;&#x435;&#x43D;&#x438;&#x44F; &#x442;&#x435;&#x43C;&#x44B; / object](../.gitbook/assets/46zufad5%20%285%29.jpg)

12.Мы можем вычислить новое положение и ориентацию из следующих уравнений:

![&#x420;&#x438;&#x441;&#x443;&#x43D;&#x43E;&#x43A; 11: &#x423;&#x440;&#x430;&#x432;&#x43D;&#x435;&#x43D;&#x438;&#x435; &#x434;&#x43B;&#x44F; &#x432;&#x44B;&#x447;&#x438;&#x441;&#x43B;&#x435;&#x43D;&#x438;&#x44F; &#x43F;&#x43E;&#x43B;&#x43E;&#x436;&#x435;&#x43D;&#x438;&#x44F; &#x43E;&#x431;&#x44A;&#x435;&#x43A;&#x442;&#x430;](../.gitbook/assets/46zufad5.jpg)

Здесь H - матрица гомографии 3 × 3, \(x1, y1\) - положение объекта в сохраненном изображении, а \(x2, y2\) - вычисленное положение объекта в текущий кадр. 

Вы можете проверить исходный код узла print\_objected\_src, чтобы получить преобразование, используя матрицу гомографии. Вот исходный код этого узла: [https://github.com/introlab/find-object/blob/master/src/ros/prin](https://github.com/introlab/find-object/blob/master/src/ros/prin)t\_objects\_detected\_node.cpp.

